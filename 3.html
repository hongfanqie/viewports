<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Meta Viewport | 红番茄 hongfanqie.org</title>
  <meta name="description" content="meta 标签 viewport 属性。 红番茄 hongfanqie.org，优质的前端资料翻译。" />
  <meta name="viewport" content="initial-scale=1.0" />
  <meta name="format-detection" content="telephone=no">
  <link rel="stylesheet" href="css/highlight.css" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
<div class="wrap">
<h1 id="meta-viewport">Meta Viewport</h1>
<h2 id="译者序">译者序</h2>
<p>由 <a href="http://yanxyz.net">Ivan Yan</a> 翻译，译文版权<a href="http://creativecommons.org/licenses/by-nc/4.0/">&quot;署名-非商用&quot;</a>，意见<a href="https://github.com/hongfanqie/viewports">反馈</a>。</p>
<p>注意这是选译，不包含兼容性表等内容，请同时参看<a href="http://www.quirksmode.org/mobile/metaviewport/">原文</a>。</p>
<h2 id="正文">正文</h2>
<p>这里不研究 <code>@viewport</code>，等我弄明白它是怎么回事之后再说。</p>
<h2 id="section"><meta viewport></h2>
<p><code>&lt;meta viewport&gt;</code> 最开始是由 Apple 为 iPhone 发明的。随着它被广泛使用，其它移动浏览器也实现了它，包括它的不合理部分。</p>
<p>同时 <a href="http://dev.w3.org/csswg/css-device-adapt/">W3C</a> 也制作了一份规范。尽管我愿意了解它，以对比我的发现，但是它的内容恐怕我不能理解，即便是现在我已经理解 <code>&lt;meta viewport&gt;</code> 了。例如，我认为 W3C 的一个概念 extend-to-zoom 跟我说的 ideal viewport 意思一样，不过我不能完全确认。所以我希望这篇文章可以作为这份规范的一份英语翻译，不过我不能确信。</p>
<p><code>&lt;meta viewport&gt;</code> 指定浏览器的 viewport 与缩放。特别是开发者可以用它设置 layout viewport 的宽度——CSS 的声明比如 <code>width: 20%</code> 基于这个宽度计算。</p>
<p>它有下面的语法：</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">&quot;viewport&quot;</span><span class="ot"> content=</span><span class="st">&quot;name=value,name=value&quot;</span><span class="kw">&gt;</span></code></pre>
<h3 id="指令">指令</h3>
<p>每对 name/value 是一个指令（指令 directive，这是我的自创词）。共有 6 个：</p>
<ul>
<li><code>width</code> 设置 layout viewport 的宽度。</li>
<li><code>initial-scale</code> 设置页面初始缩放级别，以及 layout viewport 宽度。</li>
<li><code>minimum-scale</code> 设置页面最小的缩放级别。</li>
<li><code>maximum-scale</code> 设置页面最大的缩放级别。</li>
<li><code>height</code> 设置 layout viewport 的高度，不是全都支持。</li>
<li><code>user-scalable</code> 当为 “0” 时阻止用户缩放，绝对不要用。</li>
</ul>
<h3 id="device-width">device-width</h3>
<p><code>width</code> 特殊值：<code>device-width</code>，设置 layout viewport 宽度为 ideal viewport 的宽度。</p>
<p>理论上类似的也有个 <code>device-height</code>，但是它的效果不如预期。</p>
<h2 id="三种-viewport">三种 viewport</h2>
<p>几年前我<a href="2.html">报告</a>了移动浏览器有两种 viewport: visual viewport 和 layout viewport。如果不清楚请再看一遍。</p>
<h3 id="ideal-viewport">ideal viewport</h3>
<p>还有第三种 viewport，我称之为 ideal viewport，即页面在设备上的理想尺寸。因而它的尺寸随设备的不同而不同。</p>
<p>旧的或便宜的设备，不是视网膜屏的，它的 ideal viewport 等于设备的物理像素值。新的设备，有更高的物理像素密度，仍然保持旧的 ideal viewport，因为它是设备的理想适配。</p>
<p>iPhone 4s 及之前的版本，不管它是不是视网膜屏，ideal viewport 都是 320x480。这是因为 320x480 是 iPhone 上页面的理想尺寸。</p>
<p>关于 ideal viewport 有两个要点：</p>
<ul>
<li>layout viewport 可以设为 ideal viewport 的值，比如 <code>width=device-width</code> 及 <code>initial-scale=1</code>。</li>
<li><code>scale</code> 是相对于 ideal viewport，与 layout viewport 无关。因此 <code>maximum-scale=3</code> 意思是最大可以放大到 ideal viewport 的 300%。</li>
</ul>
<h3 id="获得-ideal-viewport-的尺寸">获得 ideal viewport 的尺寸</h3>
<p>能够获得 ideal viewport 的尺寸有时会有用处，不过这需要运气。</p>
<p>嗯，你能做到。假设一个页面有下面 <code>&lt;meta&gt;</code>，并且获得 <code>document.documentElement.clientWidth/Height</code>:</p>
<pre class="sourceCode css"><code class="sourceCode css">&lt;meta name=<span class="st">&quot;viewport&quot;</span> content=<span class="st">&quot;width=device-width,initial-scale=1&quot;</span>&gt;</code></pre>
<p>不是这样的话就没有办法获得 ideal viewport 的尺寸。我希望这里能用上 <code>screen.width/height</code>，但是只有 BlackBerry 给出正确的值。</p>
<p>开放问题：<code>screen.width/height</code> 应当给出 ideal viewport 的尺寸吗？正方：这两个属性至少将包含有用的信息。反方：ideal viewport 没必须等于物理像素值。</p>
<h3 id="最大与最小尺寸">最大与最小尺寸</h3>
<p>layout viewport 的最大尺寸是 10,000px，我不完全相信这个数值，因为浏览器不能放大到这么大。</p>
<p>layout viewport 的最大尺寸是 ideal viewport 的 1/10，这也是最小缩放（0.1）。例外：Android WebKit 与 IE 不能小于 320px。</p>
<h2 id="缩放">缩放</h2>
<p>缩放让人难以捉摸。理论上很简单：确定缩放系数（zoom factor）。问题有二：</p>
<ul>
<li>我们不能直接获得缩放系数。我们需要获得 visual viewport 的宽度，它跟缩放系数呈反比。缩放系数越大，宽度越小。所以最小的缩放系数确定最大的宽度，反之亦然。</li>
<li>缩放系数跟 ideal viewport 相关，跟 layout viewport 无关。</li>
</ul>
<p>然后是名字。Apple 将 zoom 称为 scale, 因而 <code>&lt;media viewport&gt;</code> 的指令也这样称呼：<code>initial-scale</code>，<code>minimum-scale</code>，<code>maximum-scale</code>。为了兼容适配 iPhone 的网站，其它浏览器也只好这样。</p>
<p>这三个指令需要一个缩放系数，例如 “2”， 意思是放大到 ideal viewport 的 200%。</p>
<h3 id="公式">公式</h3>
<p>先定义公式：</p>
<pre><code>visual viewport width = ideal viewport width / zoom factor
zoom factor = ideal viewport width / visual viewport width</code></pre>
<p>因此，若 ideal viewport 的宽为 320px，缩放系数为 2，则 visual viewport 的宽为 160px。这里不考虑 layout viewport。</p>
<h3 id="最大与最小缩放系数">最大与最小缩放系数</h3>
<p>浏览器支持的最大与最小缩放系数是多少？</p>
<p>首先一个限制是 visual viewport 永远不能比 layout viewport 更宽，因而在大多数情况下最小的缩放系数是 ideal viewport width / layout viewport width。</p>
<p>理论上 iPhone 的 visual viewport 宽度最小为 32px (缩放系数为 10)，最大为 3200px (缩放系数为 0.1)。</p>
<h2 id="initial-scale">initial-scale</h2>
<p><code>initial-scale</code> 做了两件事：</p>
<ul>
<li>设置初始的缩放系数，因为是相对于 ideal viewport，所以也就计算出 visual viewport 的宽度。</li>
<li>设置 layout viewport 的宽度为上面计算的 visual viewport 的宽度。</li>
</ul>
<p>比方说，iPhone 竖屏 <code>initial-scale=2</code>，即设置 visual viewport 宽度为 160px(=320/2)。这便是 scale 指令如何作用的。</p>
<p>但是，它也设置 layout viewport 宽度为 160px。因此我们得到宽 160px 的页面。这是最小缩放。visual viewport 不能比 layout viewport 更宽，所以不能再缩小。</p>
<h3 id="矛盾">矛盾</h3>
<p>既然 <code>initial-scale</code> 设置了 layout viewport 宽度，可以创建下面矛盾的指令：</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">&quot;viewport&quot;</span><span class="ot"> content=</span><span class="st">&quot;initial-scale=1,width=400&quot;</span><span class="kw">&gt;</span></code></pre>
<p>浏览器得到矛盾的指令。让我们再次回到 iPhone 4s:</p>
<ol style="list-style-type: decimal">
<li><code>initial-scale=1</code> 告诉它设置 layout viewport 宽度：竖屏 320px，横屏 480px。</li>
<li><code>width=400</code> 告诉它设置 layout viewport 宽度：横竖屏都为 400px。</li>
</ol>
<p>浏览器的应对措施是使用最大的宽度。在我们的例子中，竖屏宽 400px（300，400），横屏宽 480px（480， 400）。</p>
<p>有道理吗？当然没有，但是浏览器就是这么做。</p>
<p>假如这里是 <code>min-width</code>，最小宽度为 400px，而且允许浏览器随需要扩大 layout viewport。</p>
<p>我不确定对 layout viewport 使用 min-width 有什么实践意义，不过如果你需要，它就在那里。</p>
<h2 id="minimummaximum-scale">minimum/maximum-scale</h2>
<p>对于 <code>minimum-scale</code> 和 <code>maximum-scale</code>，我只做了少量测试。似乎没啥问题，有两个例外。Android WebKit 不支持 <code>minimum-scale</code>。IE，一团糟。实际上我放弃去弄清楚它们了。</p>
</div>
</body>
</html>
